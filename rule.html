<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>LithMat Regras — Database Edition</title>
<style>
:root{
  --bg:#0e1118;
  --panel:#131823;
  --glass:rgba(255,255,255,0.06);
  --accent:#00e1ff;
  --border:rgba(255,255,255,0.12);
  --text:#e9edf5;
  --muted:#a2acc0;
  --radius:16px;
}
body{
  background:var(--bg);
  color:var(--text);
  margin:0;
  font-family:Arial, sans-serif;
  padding:20px;
}
.frame{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:20px;
  margin-bottom:20px;
  box-shadow:0 0 25px rgba(0,0,0,0.4);
}
.frame-title{
  font-size:26px;
  font-weight:700;
  margin-bottom:8px;
}
input, textarea{
  width:100%;
  padding:12px;
  background:var(--glass);
  border:1px solid var(--border);
  border-radius:var(--radius);
  color:var(--text);
  margin-bottom:10px;
}
button{
  background:var(--accent);
  border:none;
  padding:12px 18px;
  border-radius:var(--radius);
  cursor:pointer;
  font-weight:700;
  color:#000;
}
.rule-card{
  background:var(--glass);
  border:1px solid var(--border);
  padding:16px;
  border-radius:var(--radius);
  margin-bottom:12px;
}
.rule-title{font-size:20px;font-weight:700;}
.rule-meta{color:var(--muted);font-size:13px;margin-bottom:8px;}
</style>
</head>
<body>

<!-- POSTAGEM -->
<div class="frame">
  <div class="frame-title">Postar Regra</div>
  <input id="titulo" placeholder="Título da regra" />
  <textarea id="regra" rows="4" placeholder="Regra do grupo"></textarea>
  <input id="categoria" placeholder="Categoria" />
  <input id="user" placeholder="Nome do usuário (opcional)" />
  <input id="linkuser" placeholder="Link do perfil" />
  <button onclick="postarRegra()">Enviar</button>
</div>

<!-- FUNÇÕES -->
<div class="frame">
  <div class="frame-title">Funções</div>
  <input id="buscar" placeholder="Buscar regras..." oninput="filtrarBusca()" />
  <button onclick="ordenarNovas()">Mais novas</button>
  <button onclick="ordenarAntigas()">Mais antigas</button>
</div>

<!-- LISTA -->
<div class="frame">
  <div class="frame-title">Regras Publicadas</div>
  <div id="rules-container"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyBgU_MiSKWchHcItzu62cF_RySm0EmPKIE",
  authDomain: "bancodataregrageneral.firebaseapp.com",
  databaseURL: "https://bancodataregrageneral-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "bancodataregrageneral",
  storageBucket: "bancodataregrageneral.firebasestorage.app",
  messagingSenderId: "578599910104",
  appId: "1:578599910104:web:38e9fdf1aea786376fb5ad"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
let regras = [];

function escapar(t){return t.replace(/[<>]/g,m=>({'<':'&lt;','>':'&gt;'}[m]));}

function postarRegra(){
  const data={
    titulo:escapar(titulo.value.trim()),
    regra:escapar(regra.value.trim()),
    categoria:escapar(categoria.value.trim()),
    user:escapar(user.value.trim()),
    link:escapar(linkuser.value.trim()),
    time:Date.now()
  };
  if(!data.titulo||!data.regra){alert("Preencha título e regra!");return;}
  const id=db.ref("regras").push().key;
  db.ref("regras/"+id).set(data);
  titulo.value=""; regra.value=""; categoria.value=""; user.value=""; linkuser.value="";
}

function carregar(){
  db.ref("regras").on("value",snap=>{
    regras=[];
    snap.forEach(r=>regras.push({...r.val(),id:r.key}));
    render();
  });
}

function render(lista=regras){
  const box=document.getElementById("rules-container");
  box.innerHTML="";
  lista.forEach(r=>{
    box.innerHTML+=`
      <div class='rule-card'>
        <div class='rule-title'>${r.titulo}</div>
        <div class='rule-meta'>Categoria: ${r.categoria||"-"} • Usuário: ${r.user||"Anônimo"}</div>
        <div>${r.regra}</div>
        <br>
        ${r.link?`<a href='${r.link}' target='_blank' style='color:var(--accent)'>Perfil</a>`:""}
      </div>`;
  });
}

function filtrarBusca(){
  const q=buscar.value.toLowerCase();
  render(regras.filter(r => r.titulo.toLowerCase().includes(q) || r.regra.toLowerCase().includes(q)));
}
function ordenarNovas(){render([...regras].sort((a,b)=>b.time-a.time));}
function ordenarAntigas(){render([...regras].sort((a,b)=>a.time-b.time));}

carregar();
</script>

</body>
</html>
