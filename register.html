<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Registro de Afiliados — GbzStudio</title>

<style>
    :root{
        --bg:#0c0f15;
        --card:#10141d;
        --accent:#5ef0c3;
        --text:#e7eef7;
        --muted:#8b96a5;
    }
    body{
        margin:0;
        background:linear-gradient(180deg,#0a0c10,#0e1520);
        font-family:Inter,system-ui,Arial;
        color:var(--text);
        display:flex;
        justify-content:center;
        padding:40px 16px;
    }
    .card{
        width:100%;
        max-width:500px;
        background:var(--card);
        padding:26px;
        border-radius:16px;
        box-shadow:0 0 28px rgba(0,0,0,0.4);
        border:1px solid rgba(255,255,255,0.05);
        animation:fade .6s ease;
    }
    @keyframes fade{
        from{opacity:0; transform:translateY(10px);}
        to{opacity:1; transform:translateY(0);}
    }
    h1{
        margin:0 0 4px;
        font-size:24px;
        font-weight:700;
        letter-spacing:0.4px;
    }
    p.muted{
        margin:0 0 18px;
        color:var(--muted);
        font-size:14px;
    }
    label{
        margin-top:14px;
        display:block;
        color:var(--muted);
        font-size:13px;
    }
    input,textarea{
        width:100%;
        padding:12px;
        border-radius:10px;
        border:1px solid rgba(255,255,255,0.05);
        background:#0c1118;
        color:var(--text);
        margin-top:6px;
        font-size:15px;
    }
    button{
        width:100%;
        margin-top:20px;
        padding:12px;
        border-radius:10px;
        border:0;
        cursor:pointer;
        background:linear-gradient(90deg,var(--accent),#3adfce);
        color:#031b17;
        font-weight:700;
        font-size:15px;
        transition:.2s;
    }
    button:hover{
        opacity:.85;
        transform:scale(1.01);
    }
    .box-success{
        margin-top:20px;
        padding:15px;
        background:#142917;
        color:#b9ffce;
        border-radius:10px;
        border:1px solid #31e38c33;
        display:none;
    }
    .share-box{
        margin-top:10px;
        display:none;
    }
    .copy-btn{
        margin-top:10px;
        padding:8px 12px;
        background:#222;
        border-radius:8px;
        border:0;
        cursor:pointer;
        color:#ddd;
    }
</style>
</head>

<body>

<div class="card">
    <h1>Registro de Afiliado</h1>
    <p class="muted">Cadastre-se e receba seu código exclusivo para divulgar nossos produtos.</p>

    <label>Nome completo</label>
    <input id="fullName" placeholder="Seu nome completo">

    <label>Idade</label>
    <input id="age" type="number" placeholder="Ex: 18">

    <label>E-mail</label>
    <input id="email" type="email" placeholder="seuemail@exemplo.com">

    <label>Chave PIX</label>
    <input id="pixKey" placeholder="CPF, e-mail ou telefone">

    <button id="registerBtn">Registrar e Gerar Código</button>

    <div class="box-success" id="successBox"></div>

    <div class="share-box" id="shareArea">
        <label>Seu link de afiliado</label>
        <input id="shareLink" readonly>
        <button class="copy-btn" id="copyBtn">Copiar link</button>

        <p class="muted" style="margin-top:6px;">
            Seu código promocional:  
            <strong id="promoCode" style="font-size:15px;"></strong>
        </p>
    </div>

</div>

<script type="module">
    // Firebase v9+
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyD6UyxqTZAlPLjcadS45YYj2HUEK6fTV80",
        authDomain: "bancdataofc.firebaseapp.com",
        databaseURL: "https://bancdataofc-default-rtdb.firebaseio.com",
        projectId: "bancdataofc",
        storageBucket: "bancdataofc.firebasestorage.app",
        messagingSenderId: "1032596370698",
        appId: "1:1032596370698:web:26c710d196fb2b59e876f3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // DOM
    const fullName = document.getElementById("fullName");
    const age = document.getElementById("age");
    const email = document.getElementById("email");
    const pixKey = document.getElementById("pixKey");
    const registerBtn = document.getElementById("registerBtn");
    const successBox = document.getElementById("successBox");
    const shareArea = document.getElementById("shareArea");
    const shareLink = document.getElementById("shareLink");
    const promoCodeEl = document.getElementById("promoCode");
    const copyBtn = document.getElementById("copyBtn");

    function generatePromo(name){
        let base = name.replace(/\s+/g,"").slice(0,4).toUpperCase();
        let rand = Math.random().toString(36).substring(2,8).toUpperCase();
        return (base + rand).slice(0,10);
    }

    async function registerAffiliate(){
        const name = fullName.value.trim();
        const idade = age.value.trim();
        const mail = email.value.trim();
        const pix = pixKey.value.trim();

        if(!name || !idade || !mail || !pix)
            return alert("Preencha todos os campos!");

        const code = generatePromo(name);

        const data = {
            fullName: name,
            age: idade,
            email: mail,
            pixKey: pix,
            promoCode: code,
            createdAt: Date.now()
        };

        try{
            await set(ref(db, "affiliates/" + code), data);

            successBox.style.display = "block";
            successBox.textContent = "Registrado com sucesso!";

            promoCodeEl.textContent = code;

            const base = location.origin + location.pathname;
            shareLink.value = `${base}?ref=${code}`;

            shareArea.style.display = "block";

            localStorage.setItem("affiliateData", JSON.stringify(data));

        }catch(err){
            console.error(err);
            alert("Erro ao registrar.");
        }
    }

    registerBtn.addEventListener("click", registerAffiliate);

    copyBtn.addEventListener("click", ()=>{
        shareLink.select();
        document.execCommand("copy");
        copyBtn.textContent = "Copiado!";
        setTimeout(()=> copyBtn.textContent = "Copiar link", 1200);
    });
</script>

</body>
</html>
